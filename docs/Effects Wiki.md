# Вики по эффектам

## Команда `/effect`

Команда `/effect` используется для управления эффектами в плагине. Она доступна только игрокам с правом `myrosynthesis.effect` (по умолчанию предоставляется op).

### Синтаксис
```
/effect <add|remove|reload> [аргументы]
```

### Подкоманды
1. **Добавление эффекта** (`add`):
   ```
   /effect add <name> <stageTime> <time> <level>
   ```
   - **Описание**: Добавляет новый эффект в конфигурацию.
   - **Аргументы**:
     - `<name>`: Имя эффекта. Должно начинаться с одного из допустимых префиксов: `slow`, `poison`, `wither`, `confusion`, `blindness`, `fire`. Например, `slow1`, `fire_zone`.
     - `<stageTime>`: Время в тиках (1 тик = 1/20 секунды), через которое эффект активируется после входа игрока в зону.
     - `<time>`: Длительность эффекта в тиках.
     - `<level>`: Уровень эффекта (от 1 и выше для зелий, 0 для эффекта огня).
   - **Пример**:
     ```
     /effect add poison_zone 100 200 1
     ```
     Создаёт эффект `poison_zone`, который активируется через 5 секунд (100 тиков) после входа в зону, длится 10 секунд (200 тиков) и имеет уровень 1 (для эффекта яда).

2. **Удаление эффекта** (`remove`):
   ```
   /effect remove <name>
   ```
   - **Описание**: Удаляет эффект из конфигурации и из всех зон, где он используется.
   - **Аргументы**:
     - `<name>`: Имя эффекта, который нужно удалить.
   - **Пример**:
     ```
     /effect remove poison_zone
     ```
     Удаляет эффект `poison_zone` из `effects_config.yml` и всех зон в `zones_config.yml`.

3. **Перезагрузка конфигурации** (`reload`):
   ```
   /effect reload
   ```
   - **Описание**: Перезагружает эффекты из файла `effects_config.yml`, очищая текущий список эффектов и загружая новые.
   - **Аргументы**: Не требуются.
   - **Пример**:
     ```
     /effect reload
     ```
     Перезагружает конфигурацию эффектов. Полезно после ручного редактирования `effects_config.yml`.
---

## Конфигурационный файл `effects_config.yml`

Файл `effects_config.yml` хранит настройки всех эффектов. Он автоматически создаётся в папке плагина при первом запуске.

### Формат
```yaml
effects:
  <effect_name>:
    stageTime: <ticks>
    time: <ticks>
    level: <level>
```

- **effects**: Главная секция, содержащая все эффекты.
- **<effect_name>**: Уникальное имя эффекта (должно начинаться с `slow`, `poison`, `wither`, `confusion`, `blindness`, `fire`).
- **stageTime**: Время в тиках, через которое эффект активируется после входа игрока в зону (≥ 0).
- **time**: Длительность эффекта в тиках (> 0).
- **level**: Уровень эффекта (≥ 0, для зелий — от 1, для огня — обычно 0).

### Пример
```yaml
effects:
  slow1:
    stageTime: 100
    time: 200
    level: 1
  poison_zone:
    stageTime: 200
    time: 300
    level: 2
  fire1:
    stageTime: 0
    time: 60
    level: 0
```

- `slow1`: Замедление уровня 1, активируется через 5 секунд (100 тиков), длится 10 секунд (200 тиков).
- `poison_zone`: Яд уровня 2, активируется через 10 секунд (200 тиков), длится 15 секунд (300 тиков).
- `fire1`: Поджигает игрока сразу (0 тиков), огонь длится 3 секунды (60 тиков).

### Правила
- Имена эффектов должны быть уникальными.
- Имя эффекта должно начинаться с одного из допустимых префиксов:
  - `slow` (замедление),
  - `poison` (яд),
  - `wither` (иссушение),
  - `confusion` (тошнота),
  - `blindness` (слепота),
  - `fire` (горение).
- Если эффект имеет недопустимое имя или дублирует существующее, он не загрузится, и в логе сервера появится предупреждение:
  - `Duplicate effect name found: <name>`
  - `Effect <name> does not start with a valid prefix: [slow, poison, wither, confusion, blindness, fire]`
- Параметры `stageTime`, `time` и `level` должны быть целыми числами. Некорректные значения игнорируются (по умолчанию 0).

### Редактирование
- Эффекты можно добавлять или удалять через команды `/effect add` и `/effect remove`. Изменения автоматически сохраняются в `effects_config.yml`.
- Для ручного редактирования файла используйте `/effect reload` после внесения изменений, чтобы обновить эффекты без перезапуска сервера.
- При перезагрузке через `/effect reload` текущий список эффектов очищается, и эффекты загружаются из `effects_config.yml`.

---

## Как работают эффекты
1. **Создание эффекта**:
   - Используйте `/effect add <name> <stageTime> <time> <level>` для создания эффекта.
   - Эффект сохраняется в `effects_config.yml`.

2. **Привязка к зоне**:
   - Используйте команду `/zone effects add <zoneName> <effectName>`, чтобы привязать эффект к зоне.
   - Эффект будет применяться к игрокам, находящимся в зоне, после указанного `stageTime`.

3. **Применение эффекта**:
   - Когда игрок входит в зону, плагин отслеживает время пребывания (в тиках).
   - Если время пребывания превышает `stageTime` эффекта, эффект применяется:
     - Для эффектов с префиксами `slow`, `poison`, `wither`, `confusion`, `blindness` — игрок получает эффект зелья указанного уровня и длительности.
     - Для эффектов с префиксом `fire` — игрок поджигается на указанное время.

4. **Удаление эффекта**:
   - Используйте `/effect remove <name>` для удаления эффекта.
   - Эффект удаляется из `effects_config.yml` и из всех зон, где он использовался (`zones_config.yml`).

5. **Перезагрузка конфигурации**:
   - Используйте `/effect reload` для обновления списка эффектов после ручного редактирования `effects_config.yml`.
   - Если перезагрузка не удалась, в логе сервера появится ошибка: `Failed to load effects config`.

---

## Примечания
- С книжками пока эффекты не работают.. Пока (: