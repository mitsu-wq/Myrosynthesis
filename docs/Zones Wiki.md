# Вики по зонам

---

## Команда `/zone`

Команда `/zone` используется для создания, управления и настройки зон. Она доступна только игрокам с правом `myrosynthesis.zone` (по умолчанию предоставляется op).

### Синтаксис
```
/zone <create|pos1|pos2|toggle|remove|change|effects|reload> [аргументы]
```

### Подкоманды
1. **Установка первой точки** (`pos1`):
   ```
   /zone pos1
   ```
   - **Описание**: Фиксирует текущую позицию игрока как первую точку границы зоны.
   - **Пример**:
     ```
     /zone pos1
     ```
     Сохраняет координаты игрока (x, y, z) как первую точку.

2. **Установка второй точки** (`pos2`):
   ```
   /zone pos2
   ```
   - **Описание**: Фиксирует текущую позицию игрока как вторую точку границы зоны.
   - **Пример**:
     ```
     /zone pos2
     ```
     Сохраняет координаты игрока (x, y, z) как вторую точку.

3. **Создание зоны** (`create`):
   ```
   /zone create <name>
   ```
   - **Описание**: Создаёт новую зону с указанным именем, используя точки, установленные через `pos1` и `pos2`.
   - **Аргументы**:
     - `<name>`: Уникальное имя зоны.
   - **Пример**:
     ```
     /zone create safe_zone
     ```
     Создаёт зону `safe_zone` между точками `pos1` и `pos2`.

4. **Переключение отображения** (`toggle`):
   ```
   /zone toggle <name>
   ```
   - **Описание**: Включает или выключает визуальное отображение зоны (частицы `VILLAGER_HAPPY` по границам).
   - **Аргументы**:
     - `<name>`: Имя зоны.
   - **Пример**:
     ```
     /zone toggle safe_zone
     ```
     Включает или выключает отображение зоны `safe_zone`.

5. **Удаление зоны** (`remove`):
   ```
   /zone remove <name>
   ```
   - **Описание**: Удаляет зону из конфигурации.
   - **Аргументы**:
     - `<name>`: Имя зоны.
   - **Пример**:
     ```
     /zone remove safe_zone
     ```
     Удаляет зону `safe_zone` из `zones_config.yml`.

6. **Изменение границ зоны** (`change`):
   ```
   /zone change <name>
   ```
   - **Описание**: Обновляет границы зоны, используя новые точки, установленные через `pos1` и `pos2`.
   - **Аргументы**:
     - `<name>`: Имя зоны.
   - **Пример**:
     ```
     /zone change safe_zone
     ```
     Обновляет границы зоны `safe_zone` на основе новых `pos1` и `pos2`.

7. **Управление эффектами** (`effects`):
   ```
   /zone effects <add|remove> <zoneName> <effectName>
   ```
   - **Описание**: Добавляет или удаляет эффект из зоны.
   - **Аргументы**:
     - `<add|remove>`: Действие (добавить или удалить эффект).
     - `<zoneName>`: Имя зоны.
     - `<effectName>`: Имя эффекта (должно существовать в `effects_config.yml`).
   - **Примеры**:
     ```
     /zone effects add safe_zone poison_zone
     ```
     Добавляет эффект `poison_zone` в зону `safe_zone`.
     ```
     /zone effects remove safe_zone poison_zone
     ```
     Удаляет эффект `poison_zone` из зоны `safe_zone`.

8. **Перезагрузка конфигурации** (`reload`):
   ```
   /zone reload
   ```
   - **Описание**: Перезагружает зоны из файла `zones_config.yml`, обновляя список зон.
   - **Аргументы**: Не требуются.
   - **Пример**:
     ```
     /zone reload
     ```
     Перезагружает конфигурацию зон после ручного редактирования файла.
---

## Конфигурационный файл `zones_config.yml`

Файл `zones_config.yml` хранит настройки всех зон. Он автоматически создаётся в папке плагина при первом запуске.

### Формат
```yaml
zones:
  <zone_name>:
    world: <world_name>
    min:
      x: <x>
      y: <y>
      z: <z>
    max:
      x: <x>
      y: <y>
      z: <z>
    effects: [<effect1>, <effect2>, ...]
    display: <true|false>
```

- **zones**: Главная секция, содержащая все зоны.
- **<zone_name>**: Уникальное имя зоны.
- **world**: Название мира, в котором находится зона (например, `world`, `world_nether`).
- **min**: Координаты минимальной точки зоны (x, y, z).
- **max**: Координаты максимальной точки зоны (x, y, z).
- **effects**: Список имён эффектов, применяемых в зоне (должны существовать в `effects_config.yml`).
- **display**: Булево значение, определяющее, отображаются ли границы зоны частицами (`true` — включено, `false` — выключено).

### Пример
```yaml
zones:
  safe_zone:
    world: world
    min:
      x: -100.0
      y: 64.0
      z: -100.0
    max:
      x: 100.0
      y: 128.0
      z: 100.0
    effects:
      - slow1
      - poison_zone
    display: true
  danger_zone:
    world: world_nether
    min:
      x: 0.0
      y: 50.0
      z: 0.0
    max:
      x: 50.0
      y: 100.0
      z: 50.0
    effects:
      - fire1
    display: false
```

- `safe_zone`: Зона в мире `world` с координатами от (-100, 64, -100) до (100, 128, 100). Применяет эффекты `slow1` и `poison_zone`. Отображение включено (частицы по границам).
- `danger_zone`: Зона в мире `world_nether` с координатами от (0, 50, 0) до (50, 100, 50). Применяет эффект `fire1`. Отображение выключено.

### Правила
- Имена зон должны быть уникальными.
- Координаты `min` и `max` должны находиться в одном мире.
- Эффекты в списке `effects` должны существовать в `effects_config.yml`.
- Если мир не существует или указан неверно, зона не загрузится, и в логе сервера появится предупреждение:
  - `Invalid world for zone <name>`
- При загрузке зон выводится сообщение в лог: `Loaded X zones.`

### Редактирование
- Зоны можно создавать, изменять и удалять через команды `/zone create`, `/zone change`, `/zone remove`, `/zone effects`. Изменения автоматически сохраняются в `zones_config.yml`.
- Для ручного редактирования файла используйте `/zone reload` после внесения изменений, чтобы обновить зоны без перезапуска сервера.
- При перезагрузке через `/zone reload` текущий список зон обновляется из `zones_config.yml`.

---

## Как работают зоны
1. **Создание зоны**:
   - Установите две точки с помощью `/zone pos1` и `/zone pos2`.
   - Создайте зону с помощью `/zone create <name>`.
   - Зона сохраняется в `zones_config.yml`.

2. **Добавление эффектов**:
   - Используйте `/zone effects add <zoneName> <effectName>`, чтобы привязать эффект к зоне.
   - Эффекты применяются к игрокам, находящимся в зоне, после указанного в эффекте `stageTime`.

3. **Отображение зоны**:
   - Включите отображение с помощью `/zone toggle <name>`.
   - Если `display: true`, границы зоны визуализируются частицами `VILLAGER_HAPPY` с шагом 1 блок.
   - Игроки в зоне с включённым отображением видят в строке действия (action bar) сообщение: `<green>Нахождение в зоне: X секунд (Y тиков)`.

4. **Применение эффектов**:
   - Плагин периодически (каждые 20 тиков = 1 секунда) проверяет, находятся ли игроки в зонах.
   - Если игрок в зоне, запускается задача, отслеживающая время пребывания (в тиках).
   - Эффекты из списка `effects` зоны применяются через `applyEffectById`, если время пребывания превышает `stageTime` эффекта.

5. **Удаление зоны**:
   - Используйте `/zone remove <name>` для удаления зоны.
   - Зона удаляется из `zones_config.yml`.

6. **Перезагрузка конфигурации**:
   - Используйте `/zone reload` для обновления списка зон после ручного редактирования `zones_config.yml`.
   - Если перезагрузка не удалась, в логе сервера появится ошибка: `Failed to load effects config`.

## Примечания
- Перезагрузка через `/zone reload` обновляет только зоны, не затрагивая эффекты (для эффектов используйте `/effect reload`)